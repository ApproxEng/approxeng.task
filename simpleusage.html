

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simple Usage &mdash; Approximate Engineering - Task 0.0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Task 0.0.2 documentation"
          href="_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="Change Log" href="changelog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Approximate Engineering - Task
          

          
          </a>

          
            
            
              <div class="version">
                0.0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simple Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#defining-resources">Defining Resources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constant-resources">Constant Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variable-resources">Variable Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-resources">Advanced Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#defining-tasks">Defining Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-tasks">Simple Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switching-tasks">Switching Tasks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Approximate Engineering - Task</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Simple Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="simple-usage">
<span id="simple-api"></span><h1>Simple Usage<a class="headerlink" href="#simple-usage" title="Permalink to this headline">¶</a></h1>
<p>This library helps you break down your robot code into two things: Tasks, and Resources.</p>
<blockquote>
<div><ul class="simple">
<li><p>Tasks are things your robot does, examples might be manual control, following a line, that kind of thing.
They are the intelligence behind your robot.</p></li>
<li><p>Resources are things your robot has, such as motors, sensors, connections to a game controller, flashing lights.
In this library, more specifically, resources are software representations of those (normally physical) things.
Tasks use resources to do stuff.</p></li>
</ul>
</div></blockquote>
<div class="section" id="defining-resources">
<h2>Defining Resources<a class="headerlink" href="#defining-resources" title="Permalink to this headline">¶</a></h2>
<p>Resources can vary, from simple things that never change (such as access to a motor driver board), to complex chains of
processes such as an entire image processing pipeline running across multiple cores or CPUs.</p>
<div class="section" id="constant-resources">
<h3>Constant Resources<a class="headerlink" href="#constant-resources" title="Permalink to this headline">¶</a></h3>
<p>This is the simplest kind of resource, it never changes but we want to give tasks access to it. All resources have a
name, which is used to retrieve them in a task. In this case we’ve called the motor class ‘motors’ (this could be the
object returned from initialising an explorer HAT, or any other motor driver, or it could be something you’ve written
yourself, the task framework doesn’t care!)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">register_resource</span>

<span class="c1"># Create the motor board object, this will depend on the hardware</span>
<span class="c1"># fitted to your robot.</span>
<span class="n">motor_board</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Tell the task framework about it, give it a name.</span>
<span class="n">register_resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;motors&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">motor_board</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="variable-resources">
<h3>Variable Resources<a class="headerlink" href="#variable-resources" title="Permalink to this headline">¶</a></h3>
<p>Resources like sensors could be provided in the same way, but then each of your tasks would have to make the calls to
read your sensor data, and the aim of this library is to separate out the intelligence (tasks) and access to hardware
(resources). To make this easier, resources can also be functions - in this case the value passed to each call to the
task is the result of the function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">resource</span>

<span class="nd">@resource</span>
<span class="k">def</span> <span class="nf">light_sensor</span><span class="p">():</span>
    <span class="c1"># Call your library functions to read the ambient light sensor (for example)</span>
    <span class="n">sensor_reading</span> <span class="o">=</span> <span class="o">....</span>
    <span class="c1"># And return it. This function will be called every time the task is polled, and the</span>
    <span class="c1"># result will be made available to the task</span>
    <span class="k">return</span> <span class="n">sensor_reading</span>
</pre></div>
</div>
<p>In this case we didn’t provide a name - by default the resource will have the name of the function, so in this case
‘light_sensor’ but you can also explicitly name it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">resource</span>

<span class="nd">@resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lux&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">light_sensor</span><span class="p">():</span>
    <span class="c1"># Call your library functions to read the ambient light sensor (for example)</span>
    <span class="n">sensor_reading</span> <span class="o">=</span> <span class="o">....</span>
    <span class="c1"># And return it. This function will be called every time the task is polled, and the</span>
    <span class="c1"># result will be made available to the task</span>
    <span class="k">return</span> <span class="n">sensor_reading</span>
</pre></div>
</div>
<p>This will make the sensor reading available under the ‘lux’ property to tasks which use it.</p>
</div>
<div class="section" id="advanced-resources">
<h3>Advanced Resources<a class="headerlink" href="#advanced-resources" title="Permalink to this headline">¶</a></h3>
<p>Some resources may require more extensive setup than allowed by the examples above. For these you can create your own
implementation of the <a class="reference internal" href="api.html#approxeng.task.Resource" title="approxeng.task.Resource"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code></a> class, and register it through the register_resource call.
Implementing this class allows you to access startup and shutdown methods which will be called automatically when a task
starts and stops using the resource.</p>
</div>
</div>
<div class="section" id="defining-tasks">
<h2>Defining Tasks<a class="headerlink" href="#defining-tasks" title="Permalink to this headline">¶</a></h2>
<p>Now you’ve got some resources, time to do something with them! You do this by creating tasks, and, as with the
resources, there are various ways to do that depending on how much control you need over the lifecycle.</p>
<div class="section" id="simple-tasks">
<h3>Simple Tasks<a class="headerlink" href="#simple-tasks" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">some_task</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task running&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Run the task</span>
<span class="n">run</span><span class="p">(</span><span class="n">root_task</span><span class="o">=</span><span class="s1">&#39;some_task&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code does two things. Firstly we define a task - in this case this is just a function which prints ‘Task running’
and sleeps for a second. Not terribly exciting! It is, however, a fully functional task. Note the &#64;task decorator - this
tells the framework that it’s a task, and, just like the resources, it has a default name which is the same as the
function.</p>
<p>Secondly, we run the task. The root task is the first task to run (tasks can switch to other tasks, we’ll look at that
next). Because there’s no logic here to switch tasks or to exit, this will run forever and print ‘Task running’ every
second. It also doesn’t use any resource, so it’s not a great example but you have to start somewhere. Let’s fix that.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lux&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_light_sensor</span><span class="p">():</span>
    <span class="n">sensor_reading</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">sensor_reading</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">light_monitoring_task</span><span class="p">(</span><span class="n">world</span><span class="p">):</span>
    <span class="n">light_reading</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">lux</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Light reading is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">light_reading</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">run</span><span class="p">(</span><span class="n">root_task</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code is very similar to the previous example, but we’ve also defined a resource. By doing this, and then adding the
‘world’ parameter to our task function, we’ve told the framework a few things:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>There’s a resource, called ‘lux’, that reads the light sensor when called.</p></li>
<li><p>We want access to the world - a special object that provides all resources to a task</p></li>
<li><p>Each time the task is called, we want to have up-to-date values for each of the resources</p></li>
</ol>
</div></blockquote>
<p>Sometimes reading sensors can be time consuming. There are a few ways to make this easier, you could have the resource
cache its value and only actually update from the hardware at a certain interval, but the most obvious saving is not to
even use resources we don’t actually need. Suppose the robot has a bunch of different sensors, it might have a compass,
light meter, wheel encoders, rangefinders etc. If a task doesn’t need the rangefinder we should be able to just ignore
it rather than waste time reading from it. You can do this by adding a ‘resources’ property to the task annotation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;expensive_sensor&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_the_expensive_sensor</span>
    <span class="c1"># This takes aaaaages...</span>
    <span class="c1"># ...</span>

<span class="nd">@resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lux&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_light_sensor</span><span class="p">():</span>
    <span class="n">sensor_reading</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">sensor_reading</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lux&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">light_monitoring_task</span><span class="p">(</span><span class="n">world</span><span class="p">):</span>
    <span class="n">light_reading</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">lux</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Light reading is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">light_reading</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">run</span><span class="p">(</span><span class="n">root_task</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We’ve added a (fake) expensive sensor, we want to avoid reading this unless we need it! By setting ‘resources=[‘lux’]’
on the task we’re telling the framework that the world only needs to contain the lux resource, and not the
expensive_sensor one. This means when this task is running we never touch the expensive sensor.</p>
<p>By default, if you don’t specify a list of needed resources, all available ones are used. Be careful you’re not wasting
your robot’s time with something it doesn’t need!</p>
</div>
<div class="section" id="switching-tasks">
<h3>Switching Tasks<a class="headerlink" href="#switching-tasks" title="Permalink to this headline">¶</a></h3>
<p>The examples above all run forever, they have no way to control which task is running, handle failures etc. Suppose we
want a robot that waits until the light reaches a certain level, then runs away from it. We could do this with two
tasks, and control that switches between them as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.task</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lux&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_light_sensor</span><span class="p">():</span>
    <span class="n">sensor_reading</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">sensor_reading</span>

<span class="c1"># Create the motor board object, this will depend on the hardware</span>
<span class="c1"># fitted to your robot.</span>
<span class="n">motor_board</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Tell the task framework about it, give it a name.</span>
<span class="n">register_resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;motors&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">motor_board</span><span class="p">)</span>

<span class="c1"># Task to wait for the light to get too bright</span>
<span class="nd">@task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lux&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">light_monitoring_task</span><span class="p">(</span><span class="n">world</span><span class="p">):</span>
    <span class="n">light_reading</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">lux</span>
    <span class="k">if</span> <span class="n">light_reading</span> <span class="o">&gt;</span> <span class="mi">9000</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;run_away&#39;</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;run_away&#39;</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lux&#39;</span><span class="p">,</span><span class="s1">&#39;motors&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">run_away_and_hide</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
    <span class="c1"># Fire up the motors and get out of here!</span>
    <span class="n">world</span><span class="o">.</span><span class="n">motors</span><span class="o">.</span><span class="n">go_really_fast</span><span class="p">()</span>
    <span class="n">light_reading</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">lux</span>
    <span class="k">if</span> <span class="n">light_reading</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="c1"># Ah, soothing darkness</span>
        <span class="k">return</span> <span class="s1">&#39;light_monitor&#39;</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">run</span><span class="p">(</span><span class="n">root_task</span><span class="o">=</span><span class="s1">&#39;light_monitor&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If your task function returns a value, it indicates that it wants to stop that task and do something else. Exactly what
that something else is depends on what you return.</p>
<blockquote>
<div><ul class="simple">
<li><p>If you return True, the run command will finish, no more tasks will be run.</p></li>
<li><p>If you return a String matching the name of another task, that task becomes the current one.</p></li>
</ul>
</div></blockquote>
<p>So in this case, the light_monitor waits for the light to get really bright, then switches control to the ‘run_away’
task, which in turn waits for the light to get nice and dim and hands back control to the monitor.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="changelog.html" class="btn btn-neutral float-left" title="Change Log" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, 2020 Tom Oinn
      <span class="lastupdated">
        Last updated on Jan 10, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>